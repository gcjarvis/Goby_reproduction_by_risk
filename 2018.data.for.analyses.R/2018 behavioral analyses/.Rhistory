anova(fr4,fr6) # P = 0.07, so dropped from model
#now removing Year.fact:avg.inhab (the order of removal seems arbitrary, but that's the next one)
fr7<-update(fr6, .~. -(Year:avg.inhab))
summary(fr7)
anova(fr7)
anova(fr7,fr6)
fr8<-update(fr7, .~. -(Treatment:avg.inhab))
summary(fr8)
anova(fr8)
anova(fr7,fr8)
#me8 is the final model that I will likely end up with (those are all of the fixed and random factors that I'm interested in)
hist(resid(fr8))#not bad
#LS-adjusted means from model
emmeans(fr8, pairwise~Treatment) #warning message re: interactions, but I think it's okay
visreg(fr8)
visreg(fr8, "Treatment",by="Year")
anova(fr7,fr8)
fr9<-update(fr8, .~. -(avg.inhab))
summary(fr9)
anova(fr9)
anova(fr8,fr9)
fr10<-update(fr8, .~. -(Treatment:Year))
summary(fr10)
anova(fr10)
anova(fr8,fr10)
fr11<-update(fr10,.~. -(Treatment))
summary(fr11)
anova(fr11)
anova(fr10,fr11) # chi = 5.017      df = 2    P = 0.08139 .
fr12<-update(fr10,.~. -(Year))
summary(fr12)
anova(fr12)
anova(fr10,fr12)
# 1c. interactins with conspecifics ####
ci<-lmer(courtship.min~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
hist(resid(ci))
qqnorm(resid(ci))
qqline(resid(ci))
plot(ci)
boxplot(courtship.min~Treatment,data=behave) #slightly higher variance in Low treatment
summary(ci) #seems to be a bit more variation by trial
anova(ci)
#removing three-way interaction of random effect
ci2<-update(ci, .~. -(1|avg.inhab:Treatment:Trial))
#removing three-way interaction of random effect
ci2<-update(ci, .~. -(1|avg.inhab:Treatment:Trial))
summary(ci2)
anova(ci2)
anova(ci,ci2) #no difference in models when three-way interaction with random intercept is removed
ci3<-update(ci2, .~. -(1|Treatment:Trial)) # error message, model failed to converge
summary(ci3)
anova(ci3)
anova(ci2,ci3) #no difference
ci4<-update(ci3, .~. -(1|Trial:avg.inhab))
summary(ci4)
anova(ci4)
anova(ci3,ci4)
#trial effect
ci5<-update(ci2,.~. -(1|Trial))
summary(ci5)
anova(ci5)
anova(ci2,ci5)
ci6<-update(ci4, .~. -(Treatment:Year:avg.inhab))
summary(ci6)
anova(ci6)
anova(ci4,ci6)
#now removing Year.fact:avg.inhab (the order of removal seems arbitrary, but that's the next one)
ci7<-update(ci6, .~. -(Year:avg.inhab))
summary(ci7)
anova(ci7)
anova(ci7,ci6)
ci8<-update(ci7, .~. -(Treatment:avg.inhab))
summary(ci8)
anova(ci8)
anova(ci7,ci8)
#me8 is the final model that I will likely end up with (those are all of the fixed and random factors that I'm interested in)
hist(resid(ci8))#not bad
#LS-adjusted means ciom model
emmeans(ci8, pairwise~Treatment) #warning message re: interactions, but I think it's okay
boxplot(courtship.min~Treatment,data=behave)# variances don't look too bad, and medians look pretty good to me (i.e. match up with LS-means for the most part)
library(visreg)
visreg(ci8)
visreg(ci8)
ci9<-update(ci8, .~. -(avg.inhab))
summary(ci9)
anova(ci9)
anova(ci8,ci9)
ci10<-update(ci8, .~. -(Treatment:Year))
summary(ci10)
anova(ci10)
anova(ci8,ci10)
ci11<-update(ci10,.~. -(Treatment))
summary(ci11)
anova(ci11)
anova(ci10,ci11) # chi = 5.017      df = 2    P = 0.08139 .
ci12<-update(ci10,.~. -(Year))
summary(ci12)
anova(ci12)
anova(ci10,ci12)
# 1e. interactins with conspecifics ####
mr<-lmer(movements.min~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
hist(resid(mr))
qqnorm(resid(mr))
qqline(resid(mr))
plot(mr)
boxplot(movements.min~Treatment,data=behave) #slightly higher variance in Low treatment
summary(mr) #seems to be a bit more variation by trial
anova(mr)
#removing three-way interaction of random effect
mr2<-update(mr, .~. -(1|avg.inhab:Treatment:Trial))
summary(mr2)
anova(mr2)
anova(mr,mr2) #no difference in models when three-way interaction with random intercept is removed
anova(mr2)
anova(mr,mr2) #no difference in models when three-way interaction with random intercept is removed
mr3<-update(mr2, .~. -(1|Treatment:Trial)) # error message, model failed to converge
summary(mr3)
anova(mr3)
anova(mr2,mr3) #no difference
mr4<-update(mr3, .~. -(1|Trial:avg.inhab))
summary(mr4)
anova(mr4)
anova(mr3,mr4)
#trial effect
mr5<-update(mr2,.~. -(1|Trial))
summary(mr5)
anova(mr5)
anova(mr2,mr5)
mr6<-update(mr4, .~. -(Treatment:Year:avg.inhab))
summary(mr6)
anova(mr6)
anova(mr4,mr6)
#now removing Year.fact:avg.inhab (the order of removal seems arbitrary, but that's the next one)
mr7<-update(mr6, .~. -(Year:avg.inhab))
summary(mr7)
anova(mr7)
anova(mr7,mr6)
mr8<-update(mr7, .~. -(Treatment:avg.inhab))
summary(mr8)
anova(mr8)
anova(mr7,mr8)
#me8 is the final model that I will likely end up with (those are all of the fixed and random factors that I'm interested in)
hist(resid(mr8))#not bad
#LS-adjusted means mrom model
emmeans(mr8, pairwise~Treatment) #warning message re: interactions, but I think it's okay
visreg(mr8)
mr9<-update(mr8, .~. -(avg.inhab))
summary(mr9)
anova(mr9)
anova(mr8,mr9)
mr10<-update(mr8, .~. -(Treatment:Year))
summary(mr10)
anova(mr10)
anova(mr8,mr10)
mr11<-update(mr10,.~. -(Treatment))
summary(mr11)
mr11<-update(mr10,.~. -(Treatment))
summary(mr11)
anova(mr11)
anova(mr10,mr11)
mr12<-update(mr10,.~. -(Year))
summary(mr12)
anova(mr12)
anova(mr10,mr12)
reco.plot<- ggplot(exp, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y="Proportion of Time Exposed") +
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.807))
reco.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
# 2. plotting ####
# proportion of time exposed ####
exp<-with(behave, aggregate((proportion.exposed), list(Treatment=Treatment), mean))
exp$se<-with(behave, aggregate((proportion.exposed), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
reco.plot<- ggplot(exp, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y="Proportion of Time Exposed") +
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.807))
reco.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
# linear distance traveled####
td<-with(behave, aggregate((total.dist.moved), list(Treatment=Treatment), mean))
td$se<-with(behave, aggregate((total.dist.moved), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
exp<-with(behave, aggregate((proportion.exposed), list(Treatment=Treatment), mean))
exp$se<-with(behave, aggregate((proportion.exposed), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
exp.plot<- ggplot(exp, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y="Proportion of Time Exposed") +
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.807))
exp.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
td<-with(behave, aggregate((total.dist.moved), list(Treatment=Treatment), mean))
td$se<-with(behave, aggregate((total.dist.moved), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
td.plot<- ggplot(td, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y="Linear Distance Traveled (mm)") +
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,205))
td.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
fr<-with(behave, aggregate((bites.min), list(Treatment=Treatment), mean))
fr$se<-with(behave, aggregate((bites.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
fr.plot<- ggplot(fr, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment",y=(expression(atop("Foraging",
paste((bites~min^-1))))))+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,1.01))
fr.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
cr<-with(behave, aggregate((courtship.min), list(Treatment=Treatment), mean))
cr$se<-with(behave, aggregate((courtship.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
cr.plot<- ggplot(cr, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y = "Courtship Displays per Minute")+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,1.5))
cr.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
cr<-with(behave, aggregate((courtship.min), list(Treatment=Treatment), mean))
cr$se<-with(behave, aggregate((courtship.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
cr.plot<- ggplot(cr, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y = "Courtship Displays per Minute")+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.15))
cr.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
cr<-with(behave, aggregate((courtship.min), list(Treatment=Treatment), mean))
cr$se<-with(behave, aggregate((courtship.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
cr.plot<- ggplot(cr, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y = "Courtship Displays per Minute")+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.16))
cr.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
cr<-with(behave, aggregate((courtship.min), list(Treatment=Treatment), mean))
cr$se<-with(behave, aggregate((courtship.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
cr.plot<- ggplot(cr, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y = "Courtship Displays per Minute")+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.151))
cr.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
mm<-with(behave, aggregate((movements.min), list(Treatment=Treatment), mean))
mm$se<-with(behave, aggregate((movements.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
mm.plot<- ggplot(mm, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment",y=(expression(atop("Movements min"^-1))))+
#                                         paste((movements~min^-1))))))+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,1.51),
labels = scales::number_format(accuracy = 0.01)) #changed to 2 decimal places for movement rate)
mm.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
mm.plot<- ggplot(mm, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment",y=(expression(atop("Movements min"^-1))))+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,1.51),
labels = scales::number_format(accuracy = 0.01)) #changed to 2 decimal places for movement rate)
mm.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
library(lme4)
library(lmerTest)
library(dplyr)
library(ggplot2)
library(emmeans) #for generating least-squares adjusted means from models
#importing data####
behave<-read.csv("Data/2019.10.25.behavior.includes.recollections.csv")
#data manipulation####
#adding a column for year (as a proxy for tagging procedure), where trials 1-3 = 2017, and 4-6 = 2018
# NOTE: there were no behavioral observations for high-risk uncaged reefs in trial 6
behave$Year <- ifelse(behave$Trial <=3, 2017, 2018)
#making Year and Trial factors
behave$Year<- as.factor(behave$Year)
behave$Trial<- as.factor(behave$Trial)
#making the variable "avg.inhab" ((20+reco)/2), rounded to the nearest whole fish
#using the average number of inhabitants per reef as the covariate in mixed models
behave$avg.inhab<-(ceiling((behave$Recollection+20)/2))
pairs(behave)# data viz, but also seems to mess up the plot parameters?
dev.off() #turns off the plot parameters
#changing levels of Treatment so the reference level is Low,
## - then Medium ("Treatment1"), and High ("Treatment2"), this will make sense for the summary output
behave$Treatment <- factor(behave$Treatment, levels = c("Low", "Medium", "High"))
levels(behave$Treatment)
# 1a. proportion of time exposed ####
pe<-lmer(proportion.exposed~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
#removing three-way interaction of random effect
pe2<-update(pe, .~. -(1|avg.inhab:Treatment:Trial))
pe3<-update(pe2, .~. -(1|Treatment:Trial))
pe4<-update(pe3, .~. -(1|Trial:avg.inhab)) #all interactions with covariate that were N.S. were removed, including random effects
#trial effect
pe5<-update(pe2,.~. -(1|Trial))
pe6<-update(pe4, .~. -(Treatment:Year:avg.inhab))
#now removing Year.fact:avg.inhab (the order of removal seems arbitrary, but that's the next one)
pe7<-update(pe6, .~. -(Year:avg.inhab))
pe8<-update(pe7, .~. -(Treatment:avg.inhab))
boxplot(proportion.exposed~Treatment,data=behave)# variances don't look too bad, and medians look pretty good to me (i.e. match up with LS-means for the most part)
#LS-adjusted means from model
emmeans(pe8, pairwise~Treatment) #warning message re: interactions, but I think it's okay
anova(pe8)
library(lme4)
library(lmerTest)
library(dplyr)
library(ggplot2)
library(emmeans) #for generating least-squares adjusted means from models
#importing data####
behave<-read.csv("Data/2019.10.25.behavior.includes.recollections.csv")
#data manipulation####
#adding a column for year (as a proxy for tagging procedure), where trials 1-3 = 2017, and 4-6 = 2018
# NOTE: there were no behavioral observations for high-risk uncaged reefs in trial 6
behave$Year <- ifelse(behave$Trial <=3, 2017, 2018)
#making Year and Trial factors
behave$Year<- as.factor(behave$Year)
behave$Trial<- as.factor(behave$Trial)
#changing levels of Treatment so the reference level is Low,
## - then Medium ("Treatment1"), and High ("Treatment2"), this will make sense for the summary output
behave$Treatment <- factor(behave$Treatment, levels = c("Low", "Medium", "High"))
levels(behave$Treatment)
options(contrasts = c("contr.sum","contr.poly")) #this is important, run before ANOVA, will set SS to type III
# 1a. proportion of time exposed ####
pe<-lmer(proportion.exposed~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
#making the variable "avg.inhab" ((20+reco)/2), rounded to the nearest whole fish
#using the average number of inhabitants per reef as the covariate in mixed models
behave$avg.inhab<-(ceiling((behave$Recollection+20)/2))
#data viz
pairs(behave)# data viz, but also seems to mess up the plot parameters?
# 1a. proportion of time exposed ####
pe<-lmer(proportion.exposed~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
hist(resid(pe))
qqnorm(resid(pe))
qqline(resid(pe))
plot(pe)
summary(pe) #don't seem to be very many differences based on trial
summary(pe) #don't seem to be very many differences based on trial
#removing three-way interaction of random effect
pe2<-update(pe, .~. -(1|avg.inhab:Treatment:Trial))
pe3<-update(pe2, .~. -(1|Treatment:Trial))
pe4<-update(pe3, .~. -(1|Trial:avg.inhab)) #all interactions with covariate that were N.S. were removed, including random effects
pe6<-update(pe4, .~. -(Treatment:Year:avg.inhab))
#now removing Year.fact:avg.inhab (the order of removal seems arbitrary, but that's the next one)
pe7<-update(pe6, .~. -(Year:avg.inhab))
pe8<-update(pe7, .~. -(Treatment:avg.inhab))
pe9<-update(pe8, .~. -(avg.inhab))
pe10<-update(pe8, .~. -(Treatment:Year))
pe11<-update(pe10,.~. -(Treatment))
anova(pe10,pe11) #significant effect of treatment (P = 0.01)
View(behave)
anova(pe8)
summary(pe8)
ranef(pe8)
anova(pe8)
ran<-ranef(pe8)
coef(pe8)$Trial
ranef(pe8)$Trial
(proportion.exposed~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
lmer(proportion.exposed~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
update(pe7, .~. -(Treatment:avg.inhab))
summary(pe8)
anova(pe5)
pe8a<-update(pe8, .~. -(1|Trial))
pe8a<-lm(proportion.exposed~Treatment*Year*avg.inhab, data=behave, REML=F)
pe8a<-lm(proportion.exposed~Treatment*Year*avg.inhab, data=behave)
summary(pe8a)
anova(pe8a)
anova(pe8,pe8a)
summary(pe) #don't seem to be very many differences based on trial
boxplot(proportion.exposed~Trial,data=behave)
