anova(mr6)
anova(mr4,mr6)
#now removing Year.fact:avg.inhab (the order of removal seems arbitrary, but that's the next one)
mr7<-update(mr6, .~. -(Year:avg.inhab))
summary(mr7)
anova(mr7)
anova(mr7,mr6)
mr8<-update(mr7, .~. -(Treatment:avg.inhab))
summary(mr8)
anova(mr8)
anova(mr7,mr8)
#me8 is the final model that I will likely end up with (those are all of the fixed and random factors that I'm interested in)
hist(resid(mr8))#not bad
#LS-adjusted means mrom model
emmeans(mr8, pairwise~Treatment) #warning message re: interactions, but I think it's okay
visreg(mr8)
mr9<-update(mr8, .~. -(avg.inhab))
summary(mr9)
anova(mr9)
anova(mr8,mr9)
mr10<-update(mr8, .~. -(Treatment:Year))
summary(mr10)
anova(mr10)
anova(mr8,mr10)
mr11<-update(mr10,.~. -(Treatment))
summary(mr11)
mr11<-update(mr10,.~. -(Treatment))
summary(mr11)
anova(mr11)
anova(mr10,mr11)
mr12<-update(mr10,.~. -(Year))
summary(mr12)
anova(mr12)
anova(mr10,mr12)
reco.plot<- ggplot(exp, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y="Proportion of Time Exposed") +
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.807))
reco.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
# 2. plotting ####
# proportion of time exposed ####
exp<-with(behave, aggregate((proportion.exposed), list(Treatment=Treatment), mean))
exp$se<-with(behave, aggregate((proportion.exposed), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
reco.plot<- ggplot(exp, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y="Proportion of Time Exposed") +
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.807))
reco.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
# linear distance traveled####
td<-with(behave, aggregate((total.dist.moved), list(Treatment=Treatment), mean))
td$se<-with(behave, aggregate((total.dist.moved), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
exp<-with(behave, aggregate((proportion.exposed), list(Treatment=Treatment), mean))
exp$se<-with(behave, aggregate((proportion.exposed), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
exp.plot<- ggplot(exp, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y="Proportion of Time Exposed") +
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.807))
exp.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
td<-with(behave, aggregate((total.dist.moved), list(Treatment=Treatment), mean))
td$se<-with(behave, aggregate((total.dist.moved), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
td.plot<- ggplot(td, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y="Linear Distance Traveled (mm)") +
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,205))
td.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
fr<-with(behave, aggregate((bites.min), list(Treatment=Treatment), mean))
fr$se<-with(behave, aggregate((bites.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
fr.plot<- ggplot(fr, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment",y=(expression(atop("Foraging",
paste((bites~min^-1))))))+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,1.01))
fr.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
cr<-with(behave, aggregate((courtship.min), list(Treatment=Treatment), mean))
cr$se<-with(behave, aggregate((courtship.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
cr.plot<- ggplot(cr, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y = "Courtship Displays per Minute")+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,1.5))
cr.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
cr<-with(behave, aggregate((courtship.min), list(Treatment=Treatment), mean))
cr$se<-with(behave, aggregate((courtship.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
cr.plot<- ggplot(cr, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y = "Courtship Displays per Minute")+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.15))
cr.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
cr<-with(behave, aggregate((courtship.min), list(Treatment=Treatment), mean))
cr$se<-with(behave, aggregate((courtship.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
cr.plot<- ggplot(cr, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y = "Courtship Displays per Minute")+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.16))
cr.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
cr<-with(behave, aggregate((courtship.min), list(Treatment=Treatment), mean))
cr$se<-with(behave, aggregate((courtship.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
cr.plot<- ggplot(cr, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment", y = "Courtship Displays per Minute")+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,0.151))
cr.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
mm<-with(behave, aggregate((movements.min), list(Treatment=Treatment), mean))
mm$se<-with(behave, aggregate((movements.min), list(Treatment=Treatment),
function(x) sd(x)/sqrt(length(x))))[,2]
mm.plot<- ggplot(mm, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment",y=(expression(atop("Movements min"^-1))))+
#                                         paste((movements~min^-1))))))+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,1.51),
labels = scales::number_format(accuracy = 0.01)) #changed to 2 decimal places for movement rate)
mm.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
mm.plot<- ggplot(mm, aes(x=Treatment, y=x, fill=Treatment)) +
geom_bar(stat="identity", colour= "black", width = 0.5, position="dodge")+
scale_x_discrete(limits=c("Low","Medium","High"))+
theme_classic() +
labs(x="Risk Treatment",y=(expression(atop("Movements min"^-1))))+
theme(legend.position="none") +
scale_fill_manual(values=c("grey", "grey", "grey")) +
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
theme(axis.ticks.x = element_blank()) + scale_y_continuous(expand = c(0,0),limits = c(0,1.51),
labels = scales::number_format(accuracy = 0.01)) #changed to 2 decimal places for movement rate)
mm.plot + geom_linerange(aes(ymin=x-se, ymax=x+se), size=0.5,
position=position_dodge(.85)) + theme(text = element_text(family="Arial"))
library(lme4)
library(lmerTest)
library(dplyr)
library(ggplot2)
library(emmeans) #for generating least-squares adjusted means from models
#importing data####
behave<-read.csv("Data/2019.10.25.behavior.includes.recollections.csv")
#data manipulation####
#adding a column for year (as a proxy for tagging procedure), where trials 1-3 = 2017, and 4-6 = 2018
# NOTE: there were no behavioral observations for high-risk uncaged reefs in trial 6
behave$Year <- ifelse(behave$Trial <=3, 2017, 2018)
#making Year and Trial factors
behave$Year<- as.factor(behave$Year)
behave$Trial<- as.factor(behave$Trial)
#making the variable "avg.inhab" ((20+reco)/2), rounded to the nearest whole fish
#using the average number of inhabitants per reef as the covariate in mixed models
behave$avg.inhab<-(ceiling((behave$Recollection+20)/2))
pairs(behave)# data viz, but also seems to mess up the plot parameters?
dev.off() #turns off the plot parameters
#changing levels of Treatment so the reference level is Low,
## - then Medium ("Treatment1"), and High ("Treatment2"), this will make sense for the summary output
behave$Treatment <- factor(behave$Treatment, levels = c("Low", "Medium", "High"))
levels(behave$Treatment)
# 1a. proportion of time exposed ####
pe<-lmer(proportion.exposed~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
#removing three-way interaction of random effect
pe2<-update(pe, .~. -(1|avg.inhab:Treatment:Trial))
pe3<-update(pe2, .~. -(1|Treatment:Trial))
pe4<-update(pe3, .~. -(1|Trial:avg.inhab)) #all interactions with covariate that were N.S. were removed, including random effects
#trial effect
pe5<-update(pe2,.~. -(1|Trial))
pe6<-update(pe4, .~. -(Treatment:Year:avg.inhab))
#now removing Year.fact:avg.inhab (the order of removal seems arbitrary, but that's the next one)
pe7<-update(pe6, .~. -(Year:avg.inhab))
pe8<-update(pe7, .~. -(Treatment:avg.inhab))
boxplot(proportion.exposed~Treatment,data=behave)# variances don't look too bad, and medians look pretty good to me (i.e. match up with LS-means for the most part)
#LS-adjusted means from model
emmeans(pe8, pairwise~Treatment) #warning message re: interactions, but I think it's okay
anova(pe8)
library(lme4)
library(lmerTest)
library(dplyr)
library(ggplot2)
library(emmeans) #for generating least-squares adjusted means from models
#importing data####
behave<-read.csv("Data/2019.10.25.behavior.includes.recollections.csv")
#data manipulation####
#adding a column for year (as a proxy for tagging procedure), where trials 1-3 = 2017, and 4-6 = 2018
# NOTE: there were no behavioral observations for high-risk uncaged reefs in trial 6
behave$Year <- ifelse(behave$Trial <=3, 2017, 2018)
#making Year and Trial factors
behave$Year<- as.factor(behave$Year)
behave$Trial<- as.factor(behave$Trial)
#changing levels of Treatment so the reference level is Low,
## - then Medium ("Treatment1"), and High ("Treatment2"), this will make sense for the summary output
behave$Treatment <- factor(behave$Treatment, levels = c("Low", "Medium", "High"))
levels(behave$Treatment)
options(contrasts = c("contr.sum","contr.poly")) #this is important, run before ANOVA, will set SS to type III
# 1a. proportion of time exposed ####
pe<-lmer(proportion.exposed~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
#making the variable "avg.inhab" ((20+reco)/2), rounded to the nearest whole fish
#using the average number of inhabitants per reef as the covariate in mixed models
behave$avg.inhab<-(ceiling((behave$Recollection+20)/2))
#data viz
pairs(behave)# data viz, but also seems to mess up the plot parameters?
# 1a. proportion of time exposed ####
pe<-lmer(proportion.exposed~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
hist(resid(pe))
qqnorm(resid(pe))
qqline(resid(pe))
plot(pe)
summary(pe) #don't seem to be very many differences based on trial
summary(pe) #don't seem to be very many differences based on trial
#removing three-way interaction of random effect
pe2<-update(pe, .~. -(1|avg.inhab:Treatment:Trial))
pe3<-update(pe2, .~. -(1|Treatment:Trial))
pe4<-update(pe3, .~. -(1|Trial:avg.inhab)) #all interactions with covariate that were N.S. were removed, including random effects
pe6<-update(pe4, .~. -(Treatment:Year:avg.inhab))
#now removing Year.fact:avg.inhab (the order of removal seems arbitrary, but that's the next one)
pe7<-update(pe6, .~. -(Year:avg.inhab))
pe8<-update(pe7, .~. -(Treatment:avg.inhab))
pe9<-update(pe8, .~. -(avg.inhab))
pe10<-update(pe8, .~. -(Treatment:Year))
pe11<-update(pe10,.~. -(Treatment))
anova(pe10,pe11) #significant effect of treatment (P = 0.01)
View(behave)
anova(pe8)
summary(pe8)
ranef(pe8)
anova(pe8)
ran<-ranef(pe8)
coef(pe8)$Trial
ranef(pe8)$Trial
(proportion.exposed~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
lmer(proportion.exposed~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
update(pe7, .~. -(Treatment:avg.inhab))
summary(pe8)
anova(pe5)
pe8a<-update(pe8, .~. -(1|Trial))
pe8a<-lm(proportion.exposed~Treatment*Year*avg.inhab, data=behave, REML=F)
pe8a<-lm(proportion.exposed~Treatment*Year*avg.inhab, data=behave)
summary(pe8a)
anova(pe8a)
anova(pe8,pe8a)
summary(pe) #don't seem to be very many differences based on trial
boxplot(proportion.exposed~Trial,data=behave)
library(lme4)
library(lmerTest)
library(dplyr)
library(ggplot2)
library(emmeans) #for generating least-squares adjusted means from models
#importing data####
behave<-read.csv("Data/2019.10.25.behavior.includes.recollections.csv")
#data manipulation####
#adding a column for year (as a proxy for tagging procedure), where trials 1-3 = 2017, and 4-6 = 2018
# NOTE: there were no behavioral observations for high-risk uncaged reefs in trial 6
behave$Year <- ifelse(behave$Trial <=3, 2017, 2018)
#making Year and Trial factors
behave$Year<- as.factor(behave$Year)
behave$Trial<- as.factor(behave$Trial)
#making the variable "avg.inhab" ((20+reco)/2), rounded to the nearest whole fish
#using the average number of inhabitants per reef as the covariate in mixed models
behave$avg.inhab<-(ceiling((behave$Recollection+20)/2))
options(contrasts = c("contr.sum","contr.poly")) #this is important, run before ANOVA, will set SS to type III
# 1a. proportion of time exposed ####
pe<-lmer(proportion.exposed~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
rand(pe)
#testing full model first, then reducing if necessary
pe.1<-lmer(proportion.exposed~Treatment*Year*avg.inhab, data = behave)
hist(resid(pe))
qqnorm(resid(pe))
qqline(resid(pe))
plot(pe)
summary(pe) #don't seem to be very many differences based on trial
hist(resid(pe.1))
#testing full model first, then reducing if necessary
pe.1<-lmer(proportion.exposed~Treatment*Year*avg.inhab, data = behave)
#testing full model first, then reducing if necessary
pe.1<-lm(proportion.exposed~Treatment*Year*avg.inhab, data = behave)
hist(resid(pe.1))
qqnorm(resid(pe.1))
qqline(resid(pe.1))
plot(pe.1)
summary(pe.1) #don't seem to be very many differences based on trial
anova(pe.1)
pe.2<-lm(proportion.exposed~Treatment*Year+avg.inhab, data = behave)
hist(resid(pe.2))
qqnorm(resid(pe.2))
qqline(resid(pe.2))
plot(pe.2)
summary(pe.2)
anova(pe.2)
#calculating LS means based on this linear model
emmeans(pe.2, pairwise~Treatment)
# 1b. linear distance traveled ####
dm<-lmer(total.dist.moved~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
rand(dm)
dm<-lmer(total.dist.moved~Treatment*Year*avg.inhab+(1|Trial), REML=F, data = behave)
#checking full model, then reducing fixed effects if necessary
dm.1<-lmer(total.dist.moved~Treatment*Year*avg.inhab+(1|Trial), REML=F, data = behave)
anova(dm.1)
#removing non-significant interactions (3-way and NS int with covariate)
dm.2<-lmer(total.dist.moved~Treatment*Year+avg.inhab+(1|Trial), REML=F, data = behave)
anova(dm.2)
emmeans(dm.2, pairwise~Treatment)
emmeans(dm.2, pairwise~avg.inhab)
boxplot(total.dist.moved~avg.inhab,data=behave)
# 1c. foraging rate ####
fr<-lmer(bites.min~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
rand(fr)
fr.1<-lmer(bites.min~Treatment*Year*avg.inhab+(1|Trial), REML=F, data=behave)
anova(fr.1)
fr.2<-lmer(bites.min~Treatment*Year+avg.inhab+(1|Trial), REML=F, data=behave)
summary(fr.2)
rand(fr) #trial explains some of the variance, will keep it in, all other random
fr.1<-lmer(bites.min~Treatment*Year*avg.inhab+(1|Trial), REML=F, data=behave)
rand(fr.1)
fr.2<-lmer(bites.min~Treatment*Year+avg.inhab+(1|Trial), REML=F, data=behave)
summary(fr.2)
anova(fr.2)
fr.3<-lm(bites.min~Treatment*Year+avg.inhab, data=behave)
anova(fr.3)
anova(fr.2)
#removing covariate b/c not significant
pe.3<-lm(proportion.exposed~Treatment*Year, data = behave)
anova(pe.3)
#removing number of inhabitants
dm.3<-lmer(total.dist.moved~Treatment*Year+(1|Trial), REML=F, data = behave)
anova(dm.3)
anova(dm.2)
fr.3<-lm(bites.min~Treatment*Year+avg.inhab, data=behave)
anova(fr.3)
#removing avg.inhab
fr.4<-lm(bites.min~Treatment*Year, data=behave)
anova(fr.4)
#removing avg.inhab
fr.4<-lmer(bites.min~Treatment*Year+(1|Trial),REML=F, data=behave)
anova(fr.4)
#removing avg.inhab
fr.4<-lm(bites.min~Treatment*Year+(1|Trial), data=behave)
anova(fr.4)
#removing avg.inhab
fr.4<-lm(bites.min~Treatment*Year, data=behave)
anova(fr.4)
# 1e. movement rate ####
mr<-lmer(movements.min~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
rand(mr)
# 1d. interactins with conspecifics ####
ci<-lmer(courtship.min~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
rand(ci)
ci.1<-lmer(courtship.min~Treatment*Year*avg.inhab+(1|Trial), REML=F, behave)
anova(ci.1)
#removing NS interactions
ci.2<-lmer(courtship.min~Treatment*Year*avg.inhab+(1|Trial), REML=F, behave)
#removing NS interactions
ci.2<-lmer(courtship.min~Treatment*Year+avg.inhab+(1|Trial), REML=F, behave)
anova(ci.2)
# removing covariate
ci.3<-lmer(courtship.min~Treatment*Year+(1|Trial), REML=F, behave)
anova(ci.3)
# 1e. movement rate ####
mr<-lmer(movements.min~Treatment*Year*avg.inhab+(1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, behave)
rand(mr)
mr<-lm(movements.min~Treatment*Year*avg.inhab, data = behave)
mr.1<-lm(movements.min~Treatment*Year*avg.inhab, data = behave)
anova(mr.1)
# removing NS interactions
mr.2<-lm(movements.min~Treatment*Year+avg.inhab, data = behave)
anova(mr.2)
#removing covariate
mr.3<-lm(movements.min~Treatment*Year, data = behave)
anova(mr.3)
