anova(mod_full_lme)
ranef(mod_full_lme)
rand(mod_full_lme)
fit <- lme(egg.week~Treatment*Year*avg.inhab,
random=list(Trial=~1, Treatment=~Trial, data=X, weights=varIdent(form=~1|Trial)))
fit <- lme(egg.week~Treatment*Year*avg.inhab,
random=list(Trial=~1, Treatment=~Trial, data=repro, weights=varIdent(form=~1|Trial)))
#full model:
mod_full_lme<-lme(egg.week~Treatment*Year*avg.inhab, random = list(~1|Trial,~1|Treatment:Trial,
~1|Trial:avg.inhab,1|avg.inhab:Treatment:Trial) data = repro)
#full model:
mod_full_lme<-lme(egg.week~Treatment*Year*avg.inhab, random = list(~1|Trial,~1|Treatment:Trial,
~1|Trial:avg.inhab,~1|avg.inhab:Treatment:Trial) data = repro)
#full model:
mod_full_lme<-lme(egg.week~Treatment*Year*avg.inhab, random = list(Trial=~1, Treatment:Trial=~1,
Trial:avg.inhab=1,avg.inhab:Treatment:Trial=~1, data = repro))
#full model:
mod_full_lme<-lme(egg.week~Treatment*Year*avg.inhab, random = list(Trial=~1, Treatment:Trial=~1,
Trial:avg.inhab=~1,avg.inhab:Treatment:Trial=~1, data = repro))
#full model:
mod_full_lme<-lme(egg.week~Treatment*Year*avg.inhab, random = list(Trial=~1, Treatment/Trial=~1,
Trial/avg.inhab=~1,avg.inhab/Treatment:Trial=~1, data = repro))
#nlme:
#full model:
smod_full_lme<-lme(sqrt.egg.week~Treatment*Year*avg.inhab, random = ~1|Trial, data = repro)
#fit <- lme(egg.week~Treatment*Year*avg.inhab,
#           random=list(Trial=~1, Treatment=~Trial, data=repro, weights=varIdent(form=~1|Trial)))
#full model:
mod_full_lme<-lme(egg.week~Treatment*Year*avg.inhab, random = ~1|Trial, data = repro)
anova(mod_full_lme)
#reduced model:
mod_final<-lme(egg.week~Treatment*Year+avg.inhab, random = ~1|Trial, data = repro)
#nlme:
#full model:
smod_full_lme<-lme(sqrt.egg.week~Treatment*Year*avg.inhab, random = ~1|Trial, data = repro)
anova(smod_full_lme)
## all I have to do is change the orignial model
mes<-lmer(sqrt.egg.week ~ Treatment*Year*avg.inhab + (1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, repro)
rand(mes)# trial is the only random effect that seems to exaplain any of the variance
#reduced model:
smod_final<-lme(sqrt.egg.week~Treatment*Year+avg.inhab, random = ~1|Trial, data = repro)
anova(smod_final)
mes13<-lm(sqrt.egg.week~T6.comparison*avg.inhab,data=repro.t6)
#subset treatments, caged and uncaged only to test for cage effects
## Note that Treatment factor for trial 6 models should be replaced with "T6_comparison" for analyses and plotting
repro.t6<-repro.t6[repro.t6$T6_comparison == "High" | repro.t6$T6_comparison == "Uncaged", ]
mes13<-lm(sqrt.egg.week~T6.comparison*avg.inhab,data=repro.t6)
View(repro.t6)
#subset treatments, caged and uncaged only to test for cage effects
## Note that Treatment factor for trial 6 models should be replaced with "T6_comparison" for analyses and plotting
repro.t6<-repro.t6[repro.t6$T6.comparison == "High" | repro.t6$T6.comparison == "Uncaged", ]
View(repro.t6)
#importing dataset####
repro<-read.csv("Data/8_10_20_big_dataset_repro.csv") #includes biomass, densities, and egg counts
#adding column for average number of inhabitants throughout the trial, rounded to nearest whole number of fish
repro$avg.inhab<-(ceiling((repro$recollection_male_and_female+20)/2))
#making Year and Trial factors
repro$Year<- as.factor(repro$Year)
repro$Trial<-as.factor(repro$Trial)
#sqrt-transforming egg counts to better satisfy assumptions
repro$sqrt.egg.week<-sqrt(repro$egg.week)
#subsetting data from Trial 6 for comparison of caged vs. uncaged treatments
repro.t6<-repro[repro$Trial==6,]
#subset treatments, caged and uncaged only to test for cage effects
## Note that Treatment factor for trial 6 models should be replaced with "T6_comparison" for analyses and plotting
repro.t6<-repro.t6[repro.t6$T6.comparison == "High" | repro.t6$T6.comparison == "Uncaged", ]
#subset treatments, caged and uncaged only to test for cage effects
## Note that Treatment factor for trial 6 models should be replaced with "T6_comparison" for analyses and plotting
repro.t6<-repro.t6[repro.t6$T6_comparison == "High" | repro.t6$T6_comparison == "Uncaged", ]
#subsetting data from Trial 6 for comparison of caged vs. uncaged treatments
repro.t6<-repro[repro$Trial==6,]
#subset treatments, caged and uncaged only to test for cage effects
## Note that Treatment factor for trial 6 models should be replaced with "T6_comparison" for analyses and plotting
repro.t6<-repro.t6[repro.t6$T6_comparison == "High" | repro.t6$T6_comparison == "Uncaged", ]
mes13<-lm(sqrt.egg.week~T6_comparison*avg.inhab,data=repro.t6)
anova(mes13)
mes14<-lm(sqrt.egg.week~T6.comparison+avg.inhab,data=repro.t6)
mes14<-lm(sqrt.egg.week~T6_comparison+avg.inhab,data=repro.t6)
hist(resid(mes14)) #not a super great fit, but I think it's okay
qqnorm(resid(mes14))
qqline(resid(mes14))
anova(mes13,mes14) # no difference in model after interaction was removed
anova(mes14)
#removing covariate
mes15<-lm(sqrt.egg.week~T6_comparison,data=repro.t6)
hist(resid(mes15)) #not a super great fit, but I think it's okay
qqnorm(resid(mes15))
qqline(resid(mes15))
anova(mes15)
#bimodal dist
transformed <- abs(sqrt.egg.week - mean(sqrt.egg.week))
#bimodal dist
transformed <- abs(repro.t6$sqrt.egg.week - mean(repro.t6$sqrt.egg.week))
mes15<-lm(transformed~T6_comparison,data=repro.t6)
hist(resid(mes15))
qqnorm(resid(mes15))
qqline(resid(mes15))
anova(mes15)
anova(mes15,mes14)
#removing covariate
mes15<-lm(sqrt.egg.week~T6_comparison,data=repro.t6)
anova(mes15)
me13<-lm(egg.week~T6_comparison*avg.inhab,data=repro.t6)
anova(me13)
View(repro)
source('C:/Users/George/Desktop/2018 summer/2018 Goby/Goby_reproduction_by_risk/2018.data.for.analyses.R/2018 egg counts/Scripts/reproduction_lmer_test.R', echo=TRUE)
View(repro)
head(repro)
biomass<-select(repro, -T6_comparison)
View(biomass)
biomass_all<-drop_na(repro)
View(biomass)
biomass_all_cc<-drop_na(biomass)
#same but for t6 only:
biomass_t6_cc<-drop_na(repro.t6)
#1. tests for differences in biomass among treatments:
#already did the lon-likelihood tests on my Monash computer, so I know what the final model should be
# - will just use the same procedure as I did for egg counts, and use the ran(biomass_full)
head(repro)
#full model:
biomass_full<-lmer(per_capita_female_biomass~Treatment*Year*recollection_female + (1|Trial),
(1|Treatment:Trial) +(1|Trial:recollection_female)+
(1|recollection_female:Treatment:Trial),
REML=F, repro)
#full model:
biomass_full<-lmerControl(per_capita_female_biomass~Treatment*Year*recollection_female + (1|Trial),
(1|Treatment:Trial) +(1|Trial:recollection_female)+
(1|recollection_female:Treatment:Trial),
REML=F, repro)
options(contrasts = c("contr.sum","contr.poly")) #this is important, run before ANOVA, will set SS to type III
#full model:
biomass_full<-lmer(per_capita_female_biomass~Treatment*Year*recollection_female + (1|Trial),
(1|Treatment:Trial) +(1|Trial:recollection_female)+
(1|recollection_female:Treatment:Trial),
REML=F, repro)
#full model:
biomass_full<-lmer(per_capita_female_biomass~Treatment*Year*recollection_female + (1|Trial)+
(1|Treatment:Trial) +(1|Trial:recollection_female)+
(1|recollection_female:Treatment:Trial),
REML=F, repro)
rand(biomass_full)
hist(resid(biomass_full))
anova(biomass_full)
boxplot(per_capita_female_biomass~Treatemnt,data = repro)
boxplot(per_capita_female_biomass~Treatment,data = repro)
boxplot(per_capita_female_biomass~Treatment*Trial,data = repro)
boxplot(recollection_female~Treatment*Trial,data = repro)
anova(biomass_full)
rand(biomass_full)
anova(biomass_full)
rand(biomass_full)
#full model with nlme for supplementary table
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female, random=
~1|Trial:recollection_female,
repro)
#full model with nlme for supplementary table
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female, random=
Trial*recollection_female,
repro)
#full model with nlme for supplementary table
biomass_full_nlme<-formula = per_capita_female_biomass~Treatment*Year*recollection_female, random=
Trial*recollection_female,
repro)
#full model with nlme for supplementary table
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female, random=
~1|Trial*recollection_female,
repro)
repro$trf<-(Trial*recollection_female, data=repro)
repro$trf<-(repro$Trial*repro$recollection_female)
repro$tn<-as.numeric(repro$Trial)
repro$trf<-(repro$tn*repro$recollection_female)
#full model with nlme for supplementary table
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female, random=
~1|trf,repro)
hist(resid(biomass_full_nlme))
anova(biomass_full_nlme)
#reduced model
biomass_red_nlme<-lme(per_capita_female_biomass~Treatment*Year+recollection_female
+(1|trf),
REML=F, repro)
#reduced model
biomass_red_nlme<-lme(per_capita_female_biomass~Treatment*Year+recollection_female
+(1|trf),
repro)
#reduced model
biomass_red_nlme<-lme(per_capita_female_biomass~Treatment*Year+recollection_female
random = ~1|trf,repro)
#reduced model
biomass_red_nlme<-lme(per_capita_female_biomass~Treatment*Year+recollection_female,
random = ~1|trf,repro)
hist(resid(biomass_red_nlme))
anova(biomass_red_nlme)
#full modelfor log-likelihood tests:
biomass_full<-lmer(per_capita_female_biomass~Treatment*Year*recollection_female + (1|Trial)+
(1|Treatment:Trial) +(1|Trial:recollection_female)+
(1|recollection_female:Treatment:Trial),
REML=F, repro)
anova(biomass_full)
#reduced model lmer
biomass_red_lmer<-lmer(per_capita_female_biomass~Treatment*Year*recollection_female +(1|Trial:recollection_female),
REML=F, repro)
anova(biomass_red_lmer)
boxplot(per_capita_female_biomass~Treatment, data=repro)
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female, random=
~1|trf,biomass_all_cc)
biomass_all_cc$tn<-as.numeric(repro$Trial)
biomass_all_cc$tn<-as.numeric(biomass_all_cc$Trial)
biomass_all_cc$trf<-(biomass_all_cc$tn*biomass_all_cc$recollection_female)
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female, random=
~1|trf,biomass_all_cc)
hist(resid(biomass_full_nlme))
anova(biomass_full_nlme)
boxplot(per_capita_female_biomass~Treatment, data=biomass_all_cc)
#reduced model
biomass_red_nlme<-lme(per_capita_female_biomass~Treatment*Year+recollection_female,
random = ~1|trf,biomass_all_cc)
hist(resid(biomass_red_nlme))
anova(biomass_red_nlme)
#reduced model lmer
biomass_red_lmer<-lmer(per_capita_female_biomass~Treatment*Year*recollection_female +(1|Trial:recollection_female),
REML=F, biomass_all_cc)
anova(biomass_red_lmer)
#full modelfor log-likelihood tests:
biomass_full<-lmer(per_capita_female_biomass~Treatment*Year*recollection_female + (1|Trial)+
(1|Treatment:Trial) +(1|Trial:recollection_female)+
(1|recollection_female:Treatment:Trial),
REML=F, biomass_all_cc)
hist(resid(biomass_full))
rand(biomass_full)
#reduced model lmer
biomass_red_lmer<-lmer(per_capita_female_biomass~Treatment*Year*recollection_female
+(1|Trial:recollection_female)+ (1|Trial),
REML=F, biomass_all_cc)
anova(biomass_red_lmer)
summary(biomass_red_lmer)
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female,
random= list(~1|trf,~1|Trial),biomass_all_cc)
hist(resid(biomass_full_nlme))
anova(biomass_full_nlme)
summary(biomass_full_nlme)
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female,
random= list(trf=~1, Trial=~1),biomass_all_cc)
hist(resid(biomass_full_nlme))
anova(biomass_full_nlme)
summary(biomass_full_nlme)
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female,
random= list(Trial=~1, trf=~1),biomass_all_cc)
hist(resid(biomass_full_nlme))
anova(biomass_full_nlme)
summary(biomass_full_nlme)
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female,
random= ~1|Trial,biomass_all_cc)
hist(resid(biomass_full_nlme))
anova(biomass_full_nlme)
summary(biomass_full_nlme)
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female,
random= ~(1|Trial) + (1|trf),biomass_all_cc)
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female,
random= list(Trial=~1, tnf=~1) ,biomass_all_cc, varIdent(form=~1|Trial)))
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female,
random= list(Trial=~1, tnf=~1) ,biomass_all_cc, varIdent(form=~1|Trial))
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female,
random= list(Trial=~1, trf=~1) ,biomass_all_cc, varIdent(form=~1|Trial))
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female,
random= list(trf=~1, Trial=~1) ,biomass_all_cc, varIdent(form=~1|Trial))
#full model with nlme for supplementary table
#had to make a single variable for trial*number female recollected ("tnf", see below model)
biomass_full_nlme<-lme(per_capita_female_biomass~Treatment*Year*recollection_female,
random= list(trf=~1, Trial=~1) ,biomass_all_cc, varIdent(form=~1|trf))
#trial as fixed facor
tf<-lm(sqrt.egg.week~Treatment*Year*avg.inhab*Trial, data=repro)
hist(resid(tf))
anova(resid)
#trial as fixed facor
tf<-lm(sqrt.egg.week~Treatment*Year*avg.inhab*Trial, REML=F, data=repro)
anova(tf)
library(car)
plot(tf)
anova(tf)
Anova(tf, type = "III")
Anova(tf, type = "II")
Anova(tf, type = "III")
Anova(tf, type = "I")
Anova(tf, type = "3")
#trial as fixed facor
tf<-aov(sqrt.egg.week~Treatment*Year*avg.inhab*Trial, data=repro)
Anova(tf, type = "3")
anova(tf)
me1<-update(tf, .~. -(Treatment:avg.inhab:Trial))
summary(me1)
anova(me1)
anova(tf)
summary(tf)
#trial as fixed facor
tf<-lm(sqrt.egg.week~Treatment*Year*avg.inhab*Trial, data=repro)
hist(resid(tf))
anova(tf)
summary(tf)
#trial as fixed facor
tf<-aov(sqrt.egg.week~Treatment*Year*avg.inhab*Trial, data=repro)
summary(tf)
me1<-update(tf, .~. -(Treatment:avg.inhab:Trial))
summary(me1)
anova(me1)
me2<-update(me1, .~. -(Treatment:Year:avg.inhab:Trial))
anova(me2)
me3<-update(me2, .~. -(Treatment:Year:avg.inhab))
anova(me3)
me4<-update(me3, .~. -(avg.inhab:Trial))
anova(me4)
me5<-update(me4, .~. -(Year:avg.inhab:Trial))
anova(me5)
me6<-update(me5, .~. -(Treatment:Trial))
anova(me6)
me7<-update(me6, .~. -(Treatment:Year:Trial))
anova(me7)
me8<-update(me7, .~. -(Year:avg.inhab))
anova(me8)
me9<-update(me8, .~. -(Treatment:avg.inhab))
anova(me9)
source('C:/Users/George/Desktop/2018 summer/2018 Goby/Goby_reproduction_by_risk/2018.data.for.analyses.R/2018 egg counts/Scripts/reproduction_lmer_test.R', echo=TRUE)
boxplot(egg.week~Trial, data=repro)
anova(me9)
boxplot(sqrt.egg.week~Trial, data=repro)
# 1a. all trials, raw data for reproduction per week####
# full model
me<-lmer(egg.week ~ Treatment*Year*avg.inhab + (1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, repro)
hist(resid(me))
## all I have to do is change the original model
mes<-lmer(sqrt.egg.week ~ Treatment*Year*avg.inhab + (1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, repro)
rand(mes)# trial is the only random effect that seems to exaplain any of the variance
#reduced model:
mes<-lmer(sqrt.egg.week ~ Treatment*Year+avg.inhab + (1|Trial), REML=F, repro)
hist(resid(mes))
qqnorm(resid(mes))
qqline(resid(mes))
plot(mes)
summary(mes)
anova(mes)
summary(mes)
anova(mes)
## all I have to do is change the original model
mes<-lmer(sqrt.egg.week ~ Treatment*Year*avg.inhab + (1|Trial) + (1|Treatment:Trial) +
(1|Trial:avg.inhab)+(1|avg.inhab:Treatment:Trial), REML=F, repro)
anova(mes)
rand(mes)# trial is the only random effect that seems to exaplain any of the variance
#reduced model:
mes_red<-lmer(sqrt.egg.week ~ Treatment*Year+avg.inhab + (1|Trial), REML=F, repro)
hist(resid(mes_red))
qqnorm(resid(mes_red))
qqline(resid(mes_red))
plot(mes_red)
summary(mes_red)
anova(mes_red)
rand(mes_red)
mes13<-lm(sqrt.egg.week~T6_comparison*avg.inhab,data=repro.t6)
anova(mes13)
#removing covariate
mes15<-lm(sqrt.egg.week~T6_comparison,data=repro.t6)
anova(mes15)
emmeans(mes15, pairwise~T6.comparison)
#generic code using df
t6_means<-with(repro.t6, aggregate((sqrt.egg.count), list(T6_comparison=T6_comparison), mean))
#generic code using df
t6_means<-with(repro.t6, aggregate((sqrt.egg.week), list(T6_comparison=T6_comparison), mean))
egg.means
t6_means
#now apply the se function to the 4th column [,3]
t6_means$se<-with(repro.t6, aggregate((sqrt.egg.week), list(T6_comparison=T6_comparison), function(x) sd(x)/sqrt(length(x))))[,2]
t6_means
#not sure how to back-transform standard error, but can back-transform the means to report in the paper
t6_means$btm<-(t6_means$x)^2
t6_means
boxplot(egg.week~T6_comparison,data = repro.t6)
#data for t6 t-test
t6_t_test<-read.csv("Data/t6_t_test_eggs.csv")
#t test for trial 6
t.test(t6_t_test$sqrt_high_cage ,t6_t_test$sqrt_high_uncaged)
=-0.56836^2
-0.56836^2
(-0.56836)^2
qf?
#bimodal dist, tried a tranformation, but I don't think this is legit, and I don't have a good justification for doing it
transformed <- abs(repro.t6$sqrt.egg.week - mean(repro.t6$sqrt.egg.week))
?qf
t6_means
#now apply the se function to the 4th column [,3]
t6_means$se<-with(repro.t6, aggregate((sqrt.egg.week), list(T6_comparison=T6_comparison), function(x) sd(x)/sqrt(length(x))))[,2]
t6_means
repro<-read.csv("Data/8_10_23_power_analysis.csv") #includes biomass, densities, and egg counts
pa<-read.csv("Data/8_10_23_power_analysis.csv") #includes biomass, densities, and egg counts
head(pa)
pa$avg.inhab<-(ceiling((repro$recollection_male_and_female+20)/2))
pa$sqrt.egg.week<-sqrt(pa$egg.week)
head(pa)
mod_reef<-lm(sqrt.egg.week~Treatment_power*avg.inhab, data = pa)
hist(resid(mod_reef))
anova(mod_reef)
#dropping interaction with covariate
mod_reef1<-lm(sqrt.egg.week~Treatment_power+avg.inhab, data = pa)
hist(resid(mod_reef1))
anova(mod_reef1)
emmeans((mod_reef1, pairwise~Treatment_power))
emmeans(mod_reef1, pairwise~Treatment_power)
data_trials<-with(pa, aggregate((sqrt.egg.week), list(Treatment_power=Treatment_power), mean))
data_trials<-with(pa, aggregate((sqrt.egg.week), list(Treatment_power=Treatment_power, Trial=Trial), mean))
data_trials
data_trials<-with(pa, aggregate((sqrt.egg.week), list(Treatment_power=Treatment_power, Trial=Trial, avg.inhab=avg.inhab), mean))
data_trials
data_trials<-with(pa, aggregate((sqrt.egg.week), list(avg.inhab=avg.inhab, Treatment_power=Treatment_power, Trial=Trial), mean))
data_trials
data_trials<-with(pa, aggregate((sqrt.egg.week), list(Treatment_power=Treatment_power, Trial=Trial), mean))
data_trials
#exporting this table
write.csv(repro,"Data\\power_by_trial.csv", row.names = FALSE)
#exporting this table
write.csv(data_trials,"Data\\power_by_trial.csv", row.names = FALSE)
data_trials1<-read.csv("Data/power_by_trial_density_added.csv") #includes average number of fish recollected
data_trials1$avg.inhab<-(ceiling((data_trials1$recollection+20)/2))
head(data_trials1)
mod_trial<-lm(egg.week~Treatment_power+avg.inhab, data = pa)
hist(resid(mod_trial))
anova(mod_trial)
mod_trial<-lm(egg.week~Treatment_power+avg.inhab, data = data_trials1)
hist(resid(mod_trial))
anova(mod_trial)
emmeans(mod_trial, pairwise~mod_trial) #plugged these into the calculation for power
emmeans(mod_trial, pairwise~Treatment_power) #plugged these into the calculation for power
#importing dataset####
repro<-read.csv("Data/8_10_20_big_dataset_repro.csv") #includes biomass, densities, and egg counts
#adding column for average number of inhabitants throughout the trial, rounded to nearest whole number of fish
repro$avg.inhab<-(ceiling((repro$recollection_male_and_female+20)/2))
#making Year and Trial factors
repro$Year<- as.factor(repro$Year)
repro$Trial<-as.factor(repro$Trial)
#sqrt-transforming egg counts to better satisfy assumptions
repro$sqrt.egg.week<-sqrt(repro$egg.week)
#subsetting data from Trial 6 for comparison of caged vs. uncaged treatments
repro.t6<-repro[repro$Trial==6,]
#subset treatments, caged and uncaged only to test for cage effects
## Note that Treatment factor for trial 6 models should be replaced with "T6_comparison" for analyses and plotting
repro.t6<-repro.t6[repro.t6$T6_comparison == "High" | repro.t6$T6_comparison == "Uncaged", ]
#datasets for biomass analyses:
#all trials, removing T-6 comparison column and then removing NA's
biomass<-select(repro, -T6_comparison)
biomass_all_cc<-drop_na(biomass)
#same but for t6 only:
biomass_t6_cc<-drop_na(repro.t6) #looks like I recollected fems from all reefs
# runnning per capita output as response variable with same model
head(repro1)
#trial as random
mcap3<-lmer(reproduction_per_capita_female_biomass_per_day_per_gram ~ Treatment*Year*recollection_female*(1|Trial)
+(1|Treatment:Trial)+(1|recollection_female:Trial)+(1|recollection_female:Trial:Treatment), REML = F, repro)
hist(resid(mcap3))
qqnorm(resid(mcap3))
qqline(resid(mcap3))
plot(mcap3)
summary(mcap3)
anova(mcap3)
#trial as random
mcap3<-lmer(sqrt(reproduction_per_capita_female_biomass_per_day_per_gram) ~ Treatment*Year*recollection_female*(1|Trial)
+(1|Treatment:Trial)+(1|recollection_female:Trial)+(1|recollection_female:Trial:Treatment), REML = F, repro)
hist(resid(mcap3))
qqnorm(resid(mcap3))
qqline(resid(mcap3))
plot(mcap3)
summary(mcap3)
anova(mcap3)
rand(mcap3)
#dropping all non-significant random effects
mcap4<-lmer(sqrt(reproduction_per_capita_female_biomass_per_day_per_gram) ~ Treatment*Year*recollection_female*(1|Trial), REML = F, repro)
hist(resid(mcap4))
qqnorm(resid(mcap4))
qqline(resid(mcap4))
plot(mcap4)
summary(mcap4)
anova(mcap4)
#adding covariate, not crossing
mcap5<-lmer(sqrt(reproduction_per_capita_female_biomass_per_day_per_gram) ~ Treatment*Year+recollection_female*(1|Trial), REML = F, repro)
hist(resid(mcap5))
qqnorm(resid(mcap5))
qqline(resid(mcap5))
plot(mcap5)
summary(mcap5)
anova(mcap5)
boxplot(reproduction_per_capita_female_biomass_per_day_per_gram~Treatment, data = repro)
boxplot(sqrt(reproduction_per_capita_female_biomass_per_day_per_gram)~Treatment, data = repro)
