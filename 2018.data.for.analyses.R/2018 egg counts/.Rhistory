scale_x_continuous(breaks=c(10,12,14,16,18,20))+
labs(color  = "Perceived Risk", linetype = "Perceived Risk", shape = "Perceived Risk")
anc1
dev.off()
anc1<-ggplot(repro, aes(avg.inhab, Egg.count, shape=Treatment, linetype=Treatment, col=Treatment)) +
geom_smooth(method="lm", se=FALSE, show.legend = TRUE)  +
geom_point(size=3)+
theme_classic()+
labs(x="Gobies per Reef",y=(expression(atop("Reproductive Output",
paste((eggs~laid~reef^-1))))))+
expand_limits(y=0)+
scale_color_manual(values=c("black", "#666666", "grey"))+
scale_linetype_manual(values=c("solid", "dashed", "twodash"))+
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
scale_x_continuous(breaks=c(10,12,14,16,18,20)) + scale_y_continuous(expand = c(0,0),limits = c(0,40000))+
labs(color  = "Perceived Risk", linetype = "Perceived Risk", shape = "Perceived Risk")
anc1
png("Output/2019.11.18.gobies.per.reef.9.5x5.5.300dpi.png", width = 9.5, height = 5.5, units = 'in', res = 300)
#building from the bottom, not including shape by treatment
anc1<-ggplot(repro, aes(avg.inhab, Egg.count, shape=Treatment, linetype=Treatment, col=Treatment)) +
geom_smooth(method="lm", se=FALSE, show.legend = TRUE)  +
geom_point(size=3)+
theme_classic()+
labs(x="Gobies per Reef",y=(expression(atop("Reproductive Output",
paste((eggs~laid~reef^-1))))))+
expand_limits(y=0)+
scale_color_manual(values=c("black", "#666666", "grey"))+
scale_linetype_manual(values=c("solid", "dashed", "twodash"))+
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
scale_x_continuous(breaks=c(10,12,14,16,18,20)) + scale_y_continuous(expand = c(0,0),limits = c(0,40000))+
labs(color  = "Perceived Risk", linetype = "Perceived Risk", shape = "Perceived Risk")
anc1
dev.off()
anc1<-ggplot(repro, aes(avg.inhab, Egg.count, shape=Treatment, linetype=Treatment, col=Treatment)) +
geom_smooth(method="lm", se=FALSE, show.legend = TRUE)  +
geom_point(size=3)+
theme_classic()+
labs(x="Gobies per Reef",y=(expression(atop("Reproductive Output",
paste((eggs~laid~reef^-1))))))+
expand_limits(y=0)+
scale_color_manual(values=c("black", "#666666", "grey"))+
scale_linetype_manual(values=c("solid", "dashed", "twodash"))+
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
scale_x_continuous(breaks=c(10,12,14,16,18,20)) + scale_y_continuous(limits = c(0,40000))+
labs(color  = "Perceived Risk", linetype = "Perceived Risk", shape = "Perceived Risk")
anc1
png("Output/2019.11.18.gobies.per.reef.9.5x5.5.300dpi.png", width = 9.5, height = 5.5, units = 'in', res = 300)
#building from the bottom, not including shape by treatment
anc1<-ggplot(repro, aes(avg.inhab, Egg.count, shape=Treatment, linetype=Treatment, col=Treatment)) +
geom_smooth(method="lm", se=FALSE, show.legend = TRUE)  +
geom_point(size=3)+
theme_classic()+
labs(x="Gobies per Reef",y=(expression(atop("Reproductive Output",
paste((eggs~laid~reef^-1))))))+
expand_limits(y=0)+
scale_color_manual(values=c("black", "#666666", "grey"))+
scale_linetype_manual(values=c("solid", "dashed", "twodash"))+
theme(axis.text.x=element_text(size=20, colour="black"),
axis.text.y=element_text(size=20, colour="black"),
axis.title=element_text(size=20))+
theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.title.x = element_text(margin = margin(t = 12, r = 0, b = 0, l = 0)),
axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))) +
theme(legend.text=element_text(size=18)) +
theme(legend.title =element_text(size=20))+
scale_x_continuous(breaks=c(10,12,14,16,18,20)) + scale_y_continuous(limits = c(0,40000))+
labs(color  = "Perceived Risk", linetype = "Perceived Risk", shape = "Perceived Risk")
anc1
dev.off()
library(pwr)
pwr.f2.test(u = 2, v = 99.09, f2 = 0.43, sig.level = 0.05, power = NULL)
#importing dataset, adding number of gobies on each reef, ordering treatments####
repro<-read.csv("Data/new.data.2019.9.30.csv")
library(sciplot)
library(lme4)
library(car)
library(lmerTest)
library(dplyr)
library(ggplot2)
library(MASS)
library(nlme)
library(pwr)
library(HH)#for ancova and plots
library(vegan)
repro<-na.omit(repro)
#data manipulation####
#adding column for average density, rounded to nearest whole number of fish
repro$avg.inhab<-(ceiling((repro$Recollection+20)/2))
#ordering "Treatment" and "T.6.comparison"
repro$Treatment<-ordered(repro$Treatment, levels=c("Low","Medium","High"))
repro$T6.comparison<-ordered(repro$T6.comparison, levels=c("Low","Medium","High","Uncaged"))
#importing dataset, adding number of gobies on each reef, ordering treatments####
repro<-read.csv("Data/new.data.2019.9.30.csv")
repro<-na.omit(repro) # no NA's to omit
#data manipulation####
#adding column for average density, rounded to nearest whole number of fish
repro$avg.inhab<-(ceiling((repro$Recollection+20)/2))
#adding a column for year (as a proxy for tagging procedure), where trials 1-3 = 2017, and 4-6 = 2018
repro$Year <- ifelse(repro$Trial <=3, "2017", "2018")
#adding a column for year (as a proxy for tagging procedure), where trials 1-3 = 2017, and 4-6 = 2018
repro$Year <- ifelse(repro$Trial <=3, 2017, 2018)
#want it as a factor? Going to make a variable with it as a factor, run the model, and see if I get different results
repro$Year.fact<- as.factor(repro$Year)
#modeling####
# including year, and trial nested within year, year as numeric
mod1<-lmer(Egg.count~Treatment*avg.inhab*Year*(1|Year:Trial), data=repro)
hist(resid(mod1))
qqnorm(resid(mod1))
qqline(resid(mod1))
anova(mod1, type = "III")
summary(mod1)
# including year, and trial nested within year, year as numeric
mod1.1<-lmer(Egg.count~Treatment*avg.inhab*Year.fact*(1|Year,fact:Trial), data=repro)
# including year, and trial nested within year, year as numeric
mod1.1<-lmer(Egg.count~Treatment*avg.inhab*Year.fact*(1|Year.fact:Trial), data=repro)
hist(resid(mod1.1))
qqnorm(resid(mod1.1))
qqline(resid(mod1.1))
anova(mod1.1, type = "III")
Anova(mod1.1, type = "III")
summary(mod1.1) #none of it is sig. can reduce model? also want to make sure I get the same result when year is run as numeric
#now runnning without the interaction for the random effect to see how the results change
mod1.1.1<-lmer(Egg.count~Treatment*avg.inhab*Year.fact+(1|Year.fact:Trial), data=repro)
hist(resid(mod1.1.1))
hist(resid(mod1.1))
qqnorm(resid(mod1.1.1))
qqline(resid(mod1.1.1))
anova(mod1.1.1, type = "III")
Anova(mod1.1.1, type = "III")
#anova(mod1.1.1, type = "III")
Anova(mod1.1.1, type = "III")
anova(mod1.1.1)
Anova(mod1.1.1)
Anova(mod1.1)
Anova(mod1)
#ordering "Treatment" and "T.6.comparison"
repro$Treatment.ord<-ordered(repro$Treatment, levels=c("Low","Medium","High"))
repro$T6.comparison.ord<-ordered(repro$T6.comparison, levels=c("Low","Medium","High","Uncaged"))
bargraph.CI(x.factor = Treatment.ord, response = Egg.count,
group= Year.fact, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
bargraph.CI(x.factor = Treatment.ord, response = Egg.count,
group= Trial, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
bargraph.CI(x.factor = avg.inhab, response = Egg.count,
group= Year.fact, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
lineplot.CI(avg.inhab,egg.count,group=Year.fact,legend = TRUE,main="all trials",
xlab="avg.inhab", ylab="egg count", data=temp)
lineplot.CI(avg.inhab,egg.count,group=Year.fact,legend = TRUE,main="all trials",
xlab="avg.inhab", ylab="egg count", data=repro)
lineplot.CI(avg.inhab,Egg.count,group=Year.fact,legend = TRUE,main="all trials",
xlab="avg.inhab", ylab="egg count", data=repro)
Anova(mod1.1.1)
anova(mod1.1.1)
#running reduced model taking out the three-way interaction between treatment*avg.inhab*year
mod1.2<-lmer(Egg.count~(Treatment*avg.inhab)+(Year.fact)+(1|Year.fact:Trial), data=repro)
hist(resid(mod1.2))
qqnorm(resid(mod1.2))
qqline(resid(mod1.2))
anova(mod1.2)
Anova(mod1.2)
#running reduced model taking out the three-way interaction between treatment*avg.inhab*year
mod1.2<-lmer(Egg.count~(Treatment*avg.inhab)+(Treatment*Year.fact)+(avg.inhab*Year)+(1|Year.fact:Trial), data=repro)
hist(resid(mod1.2))
qqnorm(resid(mod1.2))
qqline(resid(mod1.2))
anova(mod1.2)
Anova(mod1.2)
summary(mod1.2)
#running reduced model taking out the three-way interaction between treatment*avg.inhab*year
mod1.2<-lmer(Egg.count~(Treatment*avg.inhab)+(Treatment*Year.fact)+(avg.inhab*Year)+Treatment+avg.inhab+Year.fact+(1|Year.fact:Trial), data=repro)
hist(resid(mod1.2))
qqnorm(resid(mod1.2))
qqline(resid(mod1.2))
anova(mod1.2)
#running reduced model taking out the three-way interaction between treatment*avg.inhab*year
mod1.2<-lmer(Egg.count~(Treatment*avg.inhab)+(Treatment*Year.fact)+(avg.inhab*Year.fact)+Treatment+avg.inhab+Year.fact+(1|Year.fact:Trial), data=repro)
hist(resid(mod1.2))
qqnorm(resid(mod1.2))
qqline(resid(mod1.2))
anova(mod1.2)
Anova(mod1.2)
#running a further reduced model without treatment*year interaction, seeing how it affects results
mod1.3<-lmer(Egg.count~(Treatment*avg.inhab)+(avg.inhab*Year.fact)+Treatment+
avg.inhab+Year.fact+(1|Year.fact:Trial), data=repro)
hist(resid(mod1.3))
qqnorm(resid(mod1.3))
qqline(resid(mod1.3))
anova(mod1.3)
Anova(mod1.3)
summary(mod1.3)
anova(mod1,mod1.1,mod1.1.1,mod1.2,mod1.3)
Anova(mod1.1.1)
Anova(mod1.1.1)
anova(mod1.1.1)
anova(mod1.2)
Anova(mod1.2)
#grouped by trial
bargraph.CI(x.factor = Treatment.ord, response = Egg.count,
group= Year.fact, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
bargraph.CI(x.factor = Treatment.ord, response = Egg.count,
group= Trial, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
bargraph.CI(x.factor = avg.inhab, response = Egg.count,
group= Year.fact, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
bargraph.CI(x.factor = avg.inhab, response = Egg.count,
group= Year.fact, legend=TRUE, main="reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count",
data = repro)
bargraph.CI(x.factor = Treatment.ord, response = Egg.count,
group= Trial, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
#grouped by trial
bargraph.CI(x.factor = Treatment.ord, response = Egg.count,
group= Year.fact, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
bargraph.CI(x.factor = Treatment.ord, response = Egg.count,
group= Trial, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
bargraph.CI(x.factor = avg.inhab, response = Egg.count,
group= Year.fact, legend=TRUE, main="reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count",
data = repro)
#grouped by trial
bargraph.CI(x.factor = Treatment.ord, response = Egg.count,
group= Year.fact, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
#grouped by trial
bargraph.CI(x.factor = Treatment.ord, response = Egg.count,
group= Year.fact, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro, ylab="egg count")
lineplot.CI(avg.inhab,Egg.count,group=Year.fact,legend = TRUE,main="reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count", data=repro)
bargraph.CI(x.factor = avg.inhab, response = Egg.count,
group= Year.fact, legend=TRUE, main="reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count",
data = repro)
lineplot.CI(avg.inhab,Egg.count,group=Year.fact,legend = TRUE,main="reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count", data=repro)
bargraph.CI(x.factor = avg.inhab, response = Egg.count,
group= Year.fact, legend=TRUE, main="reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count",
data = repro)
#grouped by trial
bargraph.CI(x.factor = Treatment.ord, response = Egg.count,
group= Year.fact, legend=TRUE, main="Output by risk and year",
data = repro, ylab="egg count")
#grouped by trial
bargraph.CI(x.factor = Treatment.ord, response = Egg.count,
group= Year.fact, legend=TRUE, main="Reproduction by risk and year",
data = repro, ylab="egg count")
hist(resid(mod1.3))
qqnorm(resid(mod1.3))
qqline(resid(mod1.3))
anova(mod1.3)
Anova(mod1.3)
#comparing models that I sent to M. Steele for review (mod1.1.1, 1.2, and 1.3)
anova(mod1.1.1,mod1.2,mod1.3) #seems like model 1.3 (most reduced model) is best? Will ask M. Steele
?ifelse
library(sciplot)
library(lme4)
library(car)
library(lmerTest)
library(dplyr)
library(ggplot2)
library(MASS)
library(nlme)
library(pwr)
library(HH)#for ancova and plots
library(vegan)
#importing dataset, adding number of gobies on each reef, ordering treatments####
repro<-read.csv("Data/new.data.2019.9.30.csv")
repro<-na.omit(repro) # no NA's to omit
source('C:/Users/George/Desktop/2018 summer/2018 Goby/Goby_reproduction_by_risk/2018.data.for.analyses.R/2018 egg counts/Scripts/2019.7.12.adding.year.factor.R', echo=TRUE)
repro %>%
mutate(egg.week = ifelse(Trial<4, Egg.count/1,
ifelse(Trial == 4| Trial == 5, Egg.count/4,
ifelse(Trial == 6, Egg.count/4, NA))))
repro %>%
mutate(egg.week = ifelse(Trial<4, Egg.count/1,
ifelse(Trial == 4| Trial == 5, Egg.count/4,
ifelse(Trial == 6, Egg.count/2, NA))))
View(repro)
repro %>%
mutate(repro$egg.week = ifelse(Trial<4, Egg.count/1,
ifelse(Trial == 4| Trial == 5, ceiling(Egg.count/4),
ifelse(Trial == 6, ceiling(Egg.count/2), NA))))
repro %>%
mutate(repro$egg.week = ifelse(Trial<4, Egg.count/1,
ifelse(Trial == 4| Trial == 5, (ceiling(Egg.count/4)),
ifelse(Trial == 6, (ceiling(Egg.count/2)), NA))))
repro %>%
mutate(egg.week = ifelse(Trial<4, Egg.count/1,
ifelse(Trial == 4| Trial == 5, (ceiling(Egg.count/4)),
ifelse(Trial == 6, (ceiling(Egg.count/2)), NA))))
View(repro)
repro<-repro %>%
mutate(egg.week = ifelse(Trial<4, Egg.count/1,
ifelse(Trial == 4| Trial == 5, (ceiling(Egg.count/4)),
ifelse(Trial == 6, (ceiling(Egg.count/2)), NA))))
View(repro)
#now want to set up the new model, including new response ("egg.year") and year
mod2<-lmer(egg.week~(Treatment*avg.inhab)+(avg.inhab*Year.fact)+Treatment+
avg.inhab+Year.fact+(1|Year.fact:Trial), data=repro)
hist(resid(mod.2))
#now want to set up the new model, including new response ("egg.year") and year
mod2<-lmer(egg.week~(Treatment*avg.inhab)+(avg.inhab*Year.fact)+Treatment+
avg.inhab+Year.fact+(1|Year.fact:Trial), data=repro)
hist(resid(mod2))
qqnorm(resid(mod2))
qqline(resid(mod2))
anova(mod2)
mod2<-lmer(egg.week~Treatment*avg.inhab*Year.fact+(1|Year.fact:Trial), data=repro)
hist(resid(mod1.1.1))
qqnorm(resid(mod1.1.1))
qqline(resid(mod1.1.1))
anova(mod1.1.1)
Anova(mod1.1.1)
summary(mod1.1.1) #see sig. effect of avg. inhab. (makes sense), year (makes sense), and avg.inhab*year (makes sense)
rm(list=ls())
#importing dataset, adding number of gobies on each reef, ordering treatments####
repro<-read.csv("Data/new.data.2019.9.30.csv")
repro<-na.omit(repro) # no NA's to omit
#data manipulation####
#adding column for average density, rounded to nearest whole number of fish
repro$avg.inhab<-(ceiling((repro$Recollection+20)/2))
#adding a column for year (as a proxy for tagging procedure), where trials 1-3 = 2017, and 4-6 = 2018
repro$Year <- ifelse(repro$Trial <=3, 2017, 2018)
#want it as a factor? Going to make a variable with it as a factor, run the model, and see if I get different results
repro$Year.fact<- as.factor(repro$Year)
repro<-repro %>%
mutate(egg.week = ifelse(Trial<4, Egg.count/1,
ifelse(Trial == 4| Trial == 5, (ceiling(Egg.count/4)),
ifelse(Trial == 6, (ceiling(Egg.count/2)), NA))))
mod2<-lmer(egg.week~Treatment*avg.inhab*Year.fact+(1|Year.fact:Trial), data=repro)
hist(resid(mod2))
qqnorm(resid(mod2))
qqline(resid(mod2))
anova(mod2)
#going to run reduced model, minus three-way interaction
mod2.3<-lmer(egg.week~(Treatment*avg.inhab)+(avg.inhab*Year.fact)+Treatment+
avg.inhab+Year.fact+(1|Year.fact:Trial), data=repro)
hist(resid(mod2.3))
qqnorm(resid(mod2.3))
qqline(resid(mod2.3))
anova(mod2.3)
Anova(mod2.3)
summary(mod2.3) # same results, will check out a model comparison?
#going to run reduced model, minus three-way interaction
mod2.1<-lmer(egg.week~(Treatment*avg.inhab)+(avg.inhab*Year.fact)+Treatment+
avg.inhab+Year.fact+(1|Year.fact:Trial), data=repro)
hist(resid(mod2.1))
qqnorm(resid(mod2.1))
qqline(resid(mod2.1))
anova(mod2.1)
Anova(mod2.1)
summary(mod2.1) # only factor that is sig. is the avg.inhab, will
#maybe running this reduced model
mod2.2<-lmer(egg.week~Treatment+avg.inhab+Year.fact+(1|Year.fact:Trial),
data=repro)
hist(resid(mod2.2))
qqnorm(resid(mod2.2))
qqline(resid(mod2.2))
anova(mod2.2)
Anova(mod2.2)
summary(mod2.2) # same results, will check out a model comparison?
#comparing new models
anova(mod2,mod2.1,mod2.2)
bargraph.CI(x.factor = Treatment.ord, response = egg.week,
group= Year.fact, legend=TRUE, main="Reproduction by risk and year",
data = repro, ylab="egg count")
#ordering "Treatment" and "T.6.comparison"
repro$Treatment.ord<-ordered(repro$Treatment, levels=c("Low","Medium","High"))
repro$T6.comparison.ord<-ordered(repro$T6.comparison, levels=c("Low","Medium","High","Uncaged"))
bargraph.CI(x.factor = Treatment.ord, response = egg.week,
group= Year.fact, legend=TRUE, main="Reproduction by risk and year",
data = repro, ylab="egg count")
bargraph.CI(x.factor = Treatment.ord, response = egg.week,
group= Trial, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
bargraph.CI(x.factor = avg.inhab, response = egg.week,
group= Year.fact, legend=TRUE, main="reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count",
data = repro)
lineplot.CI(avg.inhab,egg.week,group=Year.fact,legend = TRUE,main="reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count", data=repro)
bargraph.CI(x.factor = Treatment.ord, response = egg.week,
group= Trial, legend=TRUE, main="all trials, HR combined grouped by trial",
data = repro)
bargraph.CI(x.factor = avg.inhab, response = egg.week,
group= Year.fact, legend=TRUE, main="reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count",
data = repro)
bargraph.CI(x.factor = Treatment.ord, response = egg.week,
group= Year.fact, legend=TRUE, main="Reproduction per week between years",
data = repro, ylab="egg count per reef per week")
bargraph.CI(x.factor = avg.inhab, response = egg.week,
group= Year.fact, legend=TRUE, main="reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count",
data = repro)
bargraph.CI(x.factor = avg.inhab, response = egg.week,
group= Year.fact, legend=TRUE, main="weekly reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count per reef per week",
data = repro)
lineplot.CI(avg.inhab,egg.week,group=Year.fact,legend = TRUE,main="reproduction by number of gobies",
xlab="avg.inhab", ylab="egg count", data=repro)
View(repro)
View(repro)
#running this reduced model
mod2.2<-lmer(egg.week~Treatment*Year.fact+avg.inhab+(1|Year.fact:Trial),
data=repro)
hist(resid(mod2.2))
qqnorm(resid(mod2.2))
qqline(resid(mod2.2))
anova(mod2.2)
anova(mod2.2)
#comparing new models
anova(mod2,mod2.1,mod2.2) #mod 2.2 seems to be the best mdoel in terms of AIC
Anova(mod2.2)
library(sciplot)
library(lme4)
library(car)
library(lmerTest)
library(dplyr)
library(ggplot2)
library(MASS)
library(nlme)
library(pwr)
library(HH)#for ancova and plots
library(vegan)
source('C:/Users/George/Desktop/2018 summer/2018 Goby/Goby_reproduction_by_risk/2018.data.for.analyses.R/2018 egg counts/Scripts/2019.12.12.testing.out.l.schuster.code.nlme.R', echo=TRUE)
#modeling####
#original model with lme4, reduced model (from "2019.7.12.adding.year.factor" script)
mod1.3<-lmer(Egg.count~(Treatment*avg.inhab)+(avg.inhab*Year.fact)+Treatment+
avg.inhab+Year.fact+(1|Year.fact:Trial), data=repro)
hist(resid(mod1.3))
qqnorm(resid(mod1.3))
qqline(resid(mod1.3))
anova(mod1.3)
anova(mod1.3)
Anova(mod1.3)
#modeling####
#original model with lme4, with weekly output per reef as response variable, shown is the reduced model
# - (from "2019.7.12.adding.year.factor" script)
mod2.2<-lmer(egg.week~Treatment*Year.fact+avg.inhab+(1|Year.fact:Trial),
data=repro)
repro<-repro %>%
mutate(egg.week = ifelse(Trial<4, Egg.count/1,
ifelse(Trial == 4| Trial == 5, (ceiling(Egg.count/4)),
ifelse(Trial == 6, (ceiling(Egg.count/2)), NA))))
#modeling####
#original model with lme4, with weekly output per reef as response variable, shown is the reduced model
# - (from "2019.7.12.adding.year.factor" script)
mod2.2<-lmer(egg.week~Treatment*Year.fact+avg.inhab+(1|Year.fact:Trial),
data=repro)
hist(resid(mod2.2))
qqnorm(resid(mod2.2))
qqline(resid(mod2.2))
anova(mod2.2)
Anova(mod2.2)
summary(mod2.2) # same results, will check out a model comparison?
#Lukas's model with nlme, let's do the full model and then reduce if needed
mod2.luk<-lme(egg.week~Treatment*Year.fact*avg.inhab,random=~1|Trial,repro,method="REML")
summary(mod2.luk)
summary(mlme)
summary(mod2.luk)
anova(mod2.luk, type='marginal')
#running reduced model
mod2.1.luk<-lme(egg.week~(Treatment*avg.inhab)+(avg.inhab*Year.fact)+Treatment+
avg.inhab+Year.fact,random=~1|Trial,repro,method="REML")
summary(mod2.1.luk)
anova(mod2.1.luk, type='marginal')
anova(mod2.luk, type='marginal')
#running reduced model
mod2.1.luk<-lme(egg.week~(Treatment*Year.fact)+(avg.inhab*Year.fact)+(Treatment*avg.inhab)+ Treatment+
avg.inhab+Year.fact,random=~1|Trial,repro,method="REML")
anova(mod2.1.luk, type='marginal')
#running further reduced model
mod2.1.luk<-lme(egg.week~(Treatment*Year.fact)+(avg.inhab*Year.fact)+(Treatment*avg.inhab)+ Treatment+
avg.inhab+Year.fact,random=~1|Trial,repro,method="REML")
summary(mod2.1.luk)
anova(mod2.1.luk, type='marginal')
#running further reduced model
mod2.2.luk<-lme(egg.week~(Treatment*Year.fact)+ Treatment+
avg.inhab+Year.fact,random=~1|Trial,repro,method="REML")
summary(mod2.2.luk)
anova(mod2.2.luk, type='marginal')
anova(mod2.luk,mod2.1.luk,mod2.2.luk)
